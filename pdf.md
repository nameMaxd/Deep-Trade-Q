# Выжимка и практические выводы по статье 2208.07165v1.pdf (TD3 для трейдинга)

## 1. Архитектура нейронки (TD3)
- TD3 = Actor-Critic с двумя критиками (Q1, Q2) и одним актором.
- Actor: вход — state (1+13*N), выход — action (непрерывный портфель по каждому активу).
- Critic: два Q-сети, оба получают (state, action), оценивают Q-value.
- Типовая архитектура (в статье не расписано, но best practice): 2-3 Dense слоя по 256-400 нейронов, BatchNorm, ReLU.

## 2. Лосс-функция
- Critic loss: MSE между target Q и предсказанным Q (target — минимум из двух критиков).
- Actor loss: максимизация Q-value (градиент по policy).
- Target policy smoothing: к целевому действию добавляют гауссов шум.
- Actor обновляется реже, чем critic (policy_delay).

## 3. Reward функция
- Reward: разница стоимости портфеля между шагами:  
  `r(s, a, s') = V_t - V_{t-1}`, где `V_t = b_t + h_t * C_t`.
- Комиссии обязательно вычитаются при каждой сделке.
- Short запрещён; баланс не может быть отрицательным.

## 4. State (входные признаки)
- Кэш, позиции, цены закрытия по каждому активу.
- 10+ технических индикаторов (RSI, SMA, EMA, MACD, OBV, ROC, Williams %R, Disparity Index, Stochastic Oscillator, Accumulation/Distribution).
- Sentiment score по новостям (FinBERT).
- Размерность: (1 + 13*N)

## 5. Гиперпараметры (best practice и из статьи)
- gamma: 0.99 (у тебя 0.95 — лучше поднять)
- learning_rate: 0.001
- batch_size: 128
- replay buffer: 1e5–1e6 (у тебя 10000 — лучше увеличить)
- tau: 0.005–0.01 (у тебя 1.0 — это слишком много)
- policy_delay: actor обновляется реже, например, раз в 2-3 итерации critic
- noise_std: 0.1–0.2
- commission: фиксированный процент (например, 0.1% за сделку)

## 6. Что стоит перенять в Deep-Trade-Q
- Перейти на непрерывный action space (TD3).
- Добавить больше технических индикаторов.
- Ввести sentiment score (FinBERT).
- Увеличить replay buffer, уменьшить tau.
- Обновлять actor реже, чем critic.
- Reward — только изменение портфеля, обязательно с учётом комиссии.
- Архитектура: 2-3 Dense слоя по 256-400 нейронов, BatchNorm, ReLU.

---

**Если нужно — могу расписать конкретный TD3-пайплайн под твой проект или сделать дифф по гиперпараметрам.**
